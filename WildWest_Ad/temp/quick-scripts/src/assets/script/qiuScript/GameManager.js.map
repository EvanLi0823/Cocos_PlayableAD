{"version":3,"sources":["assets/script/qiuScript/GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import aduioTools, {engineType} from \"../aduioTools\";\nimport gameConfig, {JuiceItem, JuiceItemType, LanguageType,PlayableAdType} from \"../gameConfig\";\nimport GuideScript from \"../GuideScript\";\nimport LocalAssetsManager from \"../LocalAssetsManager\";\n\n\n\nexport enum GMZIndex {\n    rewardShow = 1,\n    rewardAni = 2,\n    finish_target = 3,\n    busTips = 4,\n    gkPanel = 5,\n}\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component{\n\n    public static Instance: GameManager = null;\n\n    targetQiu: cc.Node = null;\n    tempQiu: cc.Node = null;\n\n    @property(cc.Node)\n    trayBirdNode: cc.Node = null;\n\n    @property(cc.Node)\n    footNode: cc.Node = null;\n\n    @property(cc.Prefab)\n    scorePrefab:cc.Prefab = null;\n\n    // @property(cc.Prefab)\n    // qiuPrefab: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    rewardAnimPrefab: cc.Prefab = null;\n\n    @property(cc.Node)\n    displayNode: cc.Node = null;\n\n    // @property(cc.Label)\n    // totalRewardlabel: cc.Label = null;\n\n    mergePerpetualCount = 0;\n    paTween: cc.Tween = null;\n\n    isVibration: boolean = false;\n    qiuArray: Array<cc.Node> = [];\n\n\n    @property(cc.Node)\n    canvas:cc.Node =null\n\n    @property(cc.Label)\n    tipLabel:cc.Label = null;\n    \n    @property(cc.Label)\n    download:cc.Label = null;\n\n    @property(cc.Node)\n    spineNode:cc.Node = null;\n\n    @property(cc.Node)\n    spinebigwinNode:cc.Node = null;\n\n    @property(cc.Button)\n    spinBtn:cc.Button = null;\n    \n    @property(cc.Node)\n    btnNode:cc.Node = null;\n\n    @property(cc.Node)\n    popup:cc.Node = null;\n\n    mergeCount = 0;\n    passCount = 0;\n\n    extraCount = 0;\n\n    isOver: boolean = false;\n    isClicked: boolean = false;\n    scoreNode: cc.Node = null;\n    @property(cc.Node)\n    bigwinNode: cc.Node = null;\n\n\n    isStopCounting: boolean = false; //网络请求或广告是停止计数\n    _countingSwitch: boolean = true;  //不是停止计数状态，还要操作碰撞了才能恢复计数，防止有连续合成的球自动计数\n    set countingSwitch(_countingSwitch: boolean) {\n        this._countingSwitch = _countingSwitch;\n    }\n\n    get countingSwitch() {\n        return this._countingSwitch;\n    }\n\n    onLoad() {\n        if (GameManager.Instance != null) {\n            GameManager.Instance.destroy();\n        }\n\n        gameConfig.setConfig();\n\n        // console.log(`loading ---  start`);\n        GameManager.Instance = this;    \n        cc.director.getPhysicsManager().enabled = true;\n        if (cc.sys.os === cc.sys.OS_IOS) {\n            cc.director.getPhysicsManager().gravity = new cc.Vec2(0, -1700);\n        } else if (cc.sys.os === cc.sys.OS_ANDROID) {\n            cc.director.getPhysicsManager().gravity = new cc.Vec2(0, -1700);\n        } else {\n            cc.director.getPhysicsManager().gravity = new cc.Vec2(0, -1700);\n        }\n        this.spineNode.active = false;\n         cc.tween(this.spinBtn.node)\n            .repeatForever(\n                cc.tween().sequence(\n                    cc.tween().to(1, {scale: 1.2}),\n                    cc.tween().to(1, {scale: 1})\n                )\n            )\n            .start()\n    }\n    /**-----------------------------slots------------------------------------ */\n\n    //spin按钮点击\n    onSpineClick(){\n        if (this.isClicked) {\n            return\n        }\n        this.isClicked = true;\n        this.spineNode.active = true;\n        let anim =  this.spineNode.getComponent(cc.Animation);\n        anim.once(cc.Animation.EventType.FINISHED, () => {\n            setTimeout(() => {\n                this.showTireSteak();\n            }, 100); \n        }, this);\n        anim.play()\n    }\n    //展示赢钱动画\n    showTireSteak(){\n        console.log(\"showTireSteak\")\n\n        if (!this.bigwinNode) {\n            cc.resources.load(`prefab/BigWinNode`, cc.Prefab, (err, res) => {\n                if (err) {\n                    console.error(\"Error loading BigWinNode prefab:\", err);\n                    return;\n                }\n                console.log(\"loading BigWinNode prefab:success\");\n                this.bigwinNode = cc.instantiate(res as cc.Prefab);\n                cc.find(\"Canvas/gameNode\").addChild(this.bigwinNode)\n                this.bigwinNode.active = true;\n                let anim = this.bigwinNode.getComponent(cc.Animation);\n                anim.once(cc.Animation.EventType.FINISHED, () => {\n                    anim.play(\"bigwinidle\");\n                    if (gameConfig.getPlayableAdType === PlayableAdType.Mtg) {\n                        //mtg打开下面这行\n                        window.gameEnd&&window.gameEnd(); \n                    }\n                }, this);\n                // 先播idle\n                anim.play(\"bigwin\");\n            })\n        }\n    }\n    /**---------------------------------------------------------------------- */\n \n\n\n    start() {\n        this.tipLabel.string = gameConfig.getWord(\"tipLbl\");\n        // this.download.string = gameConfig.getWord(\"download\");\n        \n        cc.resources.load(\"prefab/GuidePrefab\", cc.Prefab, (err, res) => {\n            if (res) {\n                let guideNode = cc.instantiate(res as cc.Prefab);\n                this.canvas.addChild(guideNode);\n                guideNode.getComponent(GuideScript).callback = () => {\n                    gameConfig.setGuideShow();\n                    LocalAssetsManager.releasePrefab(res);\n                    aduioTools.playBackgroundMusic();\n                };\n            }\n        })\n        if (gameConfig.getPlayableAdType === PlayableAdType.Mtg) {\n            window.gameReady && window.gameReady();\n        }\n    }\n\n    showAddReward() {\n        let rewardAnimNode = cc.instantiate(this.rewardAnimPrefab);\n\n        this.node.addChild(rewardAnimNode, GMZIndex.rewardAni);\n\n    }\n\n    gameSceneWillDisappear(): void {\n        aduioTools.stopBackgroundMusic();\n        this.pauseGame()\n    }\n\n    pauseGame() {\n        cc.director.pause();\n        this.displayNode.pauseAllActions();\n        aduioTools.pauseAllEffect();\n    }\n\n    resumeGame() {\n        cc.director.resume();\n        this.displayNode.resumeAllActions();\n        aduioTools.resuseAllEffect();\n    }\n}\n"]}