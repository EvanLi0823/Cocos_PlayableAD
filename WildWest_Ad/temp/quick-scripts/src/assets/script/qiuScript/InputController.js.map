{"version":3,"sources":["assets/script/qiuScript/InputController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import gameConfig from \"../gameConfig\";\nimport JsbSdkScript from \"../PlatformInteraction/JsbSdkScript\";\nimport GameManager from \"./GameManager\";\nimport qiuMoveScript from \"./qiuMoveScript\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class InputController extends cc.Component {\n\n    warnGraphicLine: cc.Graphics = null;\n\n    touchNum: number = 0;\n\n    aTween: cc.Tween = null;\n\n    obj = { apl: 0 }\n    onLoad() {\n\n    }\n\n    start() {\n\n    }\n\n    openTouch() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n    }\n\n    onTouchStart(e) {\n\n        if (this.touchNum == -1) {\n            return\n        }\n        if (cc.isValid(GameManager.Instance.targetQiu, true)) {\n            this.touchNum = 1;\n            // let posx = this.node.convertToNodeSpaceAR(e.getLocation()).x;\n            // let posy = GameManager.Instance.targetQiu.y;\n            // cc.tween(GameManager.Instance.targetQiu)\n            //     .to(0.1, { position: cc.v3(posx, posy, 0) })\n            //     .start();\n            //\n            // cc.tween(GameManager.Instance.trayBirdNode)\n            //     .to(0.1, { position: cc.v3(posx, GameManager.Instance.trayBirdNode.y, 0) })\n            //     .start()\n        }\n    }\n\n    onTouchMove(e) {\n        if (this.touchNum == -1) {\n            return\n        }\n        if (cc.isValid(GameManager.Instance.targetQiu, true)) {\n            this.touchNum = 1;\n            // let pos = this.node.convertToNodeSpaceAR(e.getLocation());\n            // GameManager.Instance.targetQiu.x = pos.x;\n            // GameManager.Instance.trayBirdNode.x = pos.x;\n            // let moveScript = GameManager.Instance.targetQiu.getComponent(qiuMoveScript);\n            // if(cc.isValid(moveScript , true)) {\n            //     moveScript.raylineCheck();\n            // }\n        }\n    }\n\n    onTouchEnd(e) {\n        if (cc.isValid(GameManager.Instance.targetQiu, true) && this.touchNum == 1) {\n            this.touchNum = 0;\n\n            let pos = this.node.convertToNodeSpaceAR(e.getLocation());\n            // if (pos.x > cc.winSize.width / 2 - 1 || pos.x < -cc.winSize.width / 2 + 1) {\n            //     pos.x = Math.max(-cc.winSize.width / 2 + 1, Math.min(cc.winSize.width / 2 - 1, pos.x));\n            // }\n            // GameManager.Instance.targetQiu.x = pos.x;\n            // GameManager.Instance.trayBirdNode.x = pos.x;\n\n            let targetQiu = GameManager.Instance.targetQiu;\n            GameManager.Instance.targetQiu = null;\n            let birdY = GameManager.Instance.trayBirdNode.y;\n            cc.tween(GameManager.Instance.trayBirdNode)\n                // .to(0.07, { position: cc.v3(pos.x, birdY + 60, 0) })\n                // .to(0.03, { position: cc.v3(pos.x, birdY, 0) })\n                .call(() => {\n                    if(cc.isValid(targetQiu, true)) {\n                        let com = targetQiu.getComponent(qiuMoveScript);\n                        if(cc.isValid(com, true)) {\n                            com.isDown = true;\n                        }\n                        \n                        targetQiu.getComponent(cc.RigidBody).type = cc.RigidBodyType.Dynamic;\n                        targetQiu.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, -900);\n                    }\n                    \n                    // GameManager.Instance.targetQiu = null;\n                })\n                .start();\n\n            if (gameConfig.isNewer == true){\n                gameConfig.saveNewer();\n                JsbSdkScript.buryPoint(\"debug_game_start_first\",\"\")\n            }\n            // this.scheduleOnce(() => {\n            //     GameManager.Instance.createOneQiu();\n            // }, 0.6);\n        }\n    }\n\n    showWarn(isShow: boolean, warnLineHeigh: number) {\n\n        if (isShow) {\n            if (cc.isValid(this.warnGraphicLine, true) == false) {\n                this.warnGraphicLine = this.node.addComponent(cc.Graphics);\n            }\n            this.drawLineOfDashes(this.warnGraphicLine, cc.v2(-cc.winSize.width / 2, warnLineHeigh), cc.v2(cc.winSize.width / 2, warnLineHeigh), 255)\n            // if (cc.isValid(this.aTween, true)) {\n            //     this.aTween.stop();\n            //     this.aTween = null;\n            // }\n\n            //             let currentT = 0;\n            //             this.aTween = cc.tween(this.obj)\n            //                 .repeatForever(\n            //                     cc.tween()\n            //                         .by(5, { apl: 255 }, {\n            //                             progress: (start, end: number, current, t: number) => {\n            //                                 if(Math.abs(t - currentT) < 0.04) {\n            //                                     return\n            //                                 }\n            //                                 currentT = t; \n            //                                 this.obj.apl = Math.floor(255 * t);\n            //                                 console.log(`111 ${start} | ${end}| ${current} ${t} | ${this.obj.apl}`); \n            // \n            //                                 this.drawLineOfDashes(this.warnGraphicLine, cc.v2(-cc.winSize.width / 2, warnLineHeigh), cc.v2(cc.winSize.width / 2, warnLineHeigh) , this.obj.apl)\n            //                              \n            //                             }\n            //                         })\n            //                         .call(()=> {\n            //                             this.obj.apl = 255;\n            //                         })\n            //                         .delay(0.4)\n            //                         .to(5, { apl: 0 }, {\n            //                             progress: (start, end: number, current, t: number) => {\n            //                                 if(Math.abs(t - currentT) < 0.04) {\n            //                                     return\n            //                                 }\n            //                                 currentT = t; \n            //                                 this.obj.apl = Math.floor(255 * t );\n            //                                 console.log(`222 ${start} | ${end}| ${current} ${t}| ${this.obj.apl}`);\n            //                                 this.drawLineOfDashes(this.warnGraphicLine, cc.v2(-cc.winSize.width / 2, warnLineHeigh), cc.v2(cc.winSize.width / 2, warnLineHeigh) , this.obj.apl)\n            //                             }\n            //                         })\n            //                         .call(()=> {\n            //                             this.obj.apl = 0;\n            //                         })\n            //                         .delay(0.4)\n            //                 )\n            //                 .start()\n\n        }\n        else {\n            // if (cc.isValid(this.aTween, true)) {\n            //     this.aTween.stop();\n            //     this.aTween = null;\n            // }\n            if (cc.isValid(this.warnGraphicLine, true)) {\n                this.warnGraphicLine.destroy();\n            }\n        }\n    }\n\n    drawLineOfDashes(g: cc.Graphics, from: cc.Vec2, to: cc.Vec2, alp: number, color: string = '#FF4E4E', stroke: boolean = true, length: number = 20, interval: number = 20): void {\n        if (g) {\n            //以 from：cc.v2(100, -100), to: cc.v2(500, -500) 为例\n            let off = to.sub(from);//向量减法 值为cc.v2(400, -400)\n            // console.log('向量减法', off)\n            let dir = off.normalize();//向量归一化法  值为cc.v2(0.707。。。, -0.707。。。)\n            // console.log('向量归一化法', dir)\n            let dis = off.mag();//返回该向量的长度  值为 565.685424949238\n            // console.log('向量的长度', dis)\n            let delta = dir.mul(length + interval);// 缩放向量，并返回新结果 值为cc.v2(21.213。。。, -21.213。。。)\n            // console.log('缩放向量', delta)\n            let delta1 = dir.mul(length);   //值为cc.v2(14.142。。。, -14.142。。。)\n            // console.log('缩放向量', delta1)\n            let offset = 0;\n            let mn = 3;\n            if (mn > interval) {\n                offset = mn - interval\n            }\n            let n = Math.floor(dis / (length + interval));\n            g.lineWidth = 5;//线宽 \n            g.strokeColor.fromHEX(`FF6969`)\n            g.strokeColor.setA(alp)\n            if (offset) {\n                n--;\n                g.moveTo(from.x, from.y);\n                let start0 = from.add(cc.v2(dir.x * offset, dir.y * offset));\n                g.circle(start0.x, start0.y, 2);\n            }\n            from = from.add(cc.v2(dir.x * mn, dir.y * mn))\n            for (let i = 0; i < n; ++i) {\n                let start = from.add(delta.mul(i));\n                g.moveTo(start.x, start.y);\n                let end = start.add(delta1);\n                g.circle(end.x, end.y, 1);\n            }\n            let start1 = from.add(delta.mul(n));\n            g.moveTo(start1.x, start1.y);\n            if (length < dis - (length + interval) * n - mn) {\n                let end = start1.add(delta1);\n                g.circle(end.x, end.y, 1);\n            } else {\n                g.circle(to.x, to.y, 1);\n            }\n            if (stroke) g.stroke();\n        }\n    }\n    // update (dt) {}\n}\n"]}